// Scenario list constant.
const scenarioList = [
    { id: 0, text: "On 1 November, Ahmad who lives next door to Hussain called on Hussain and offer to sell his IBM computer for RM2,000 . On 3 November, Hussain wrote and posted a letter to Ahmad accepting the offer. The letter was not addressed properly. Hence Ahmad received the letter of acceptance on 8 November instead of on 5 November. On the evening of 6 November, Ahmad telephoned Hussain and said 'I revoke my offer to you'" },
    { id: 1, text: "Cathy's son, Dave, aged 21, was studying for a diploma in computer science at a University in Kuala Lumpur. He lived in a student residence. It was a city council legislative requirement that it was illegal to smoke in student residence, offices, shops, or any enclosed place where someone else is residing, studying or working within the campus. Dave gave up smoking due to this requirement.However, Cathy was worried that under the pressure of preparing for the examination Dave would start smoking again, and so she promised to pay Dave RM500 if he did not smoke at all until he had completed the course.She also promised to buy him a car if he passed the examinations.Cathy run an online bookstore, and asked Dave to maintain and update the website from time to time.She was pleased with the result, and said she would give him RM1, 000 'for all his hard work'. Dave passed his examinations, obtained his diploma and moved to live in Johor Bahru where there was no legal requirement on banning of smoking in public enclosed areas.He has not started to smoke again after he left Kuala Lumpur.Cathy has not made either of the promised payments, or bought the car." },
    { id: 2, text: "Alan needed money quickly. He owned an original 1886 edition of Kidnapped by Robert Louis Stevenson, a book which he advertised in the newspaper for sale for $1000. Cate saw the advertisement.She telephoned Alan, saying that she would buy the book for $1000. Alan, however, replied that he had reconsidered the matter and that he could not sell the book for less than $2000.Cate replied that she would give him $1500. Alan replied that he would only sell the book for $2000 but that he would keep his offer open for seven days.He also said that Cate could fax her acceptance to him if she wanted.The next day Alan sold the book to his friend David because David loved the book so much and because he paid $7000 for it. Two days later Cate decided to purchase the book for Alan's price of $2000.She posted her acceptance to Alan.The next day David told Cate that he had bought a copy of Kidnapped from Alan for $7, 000. Cate rang Alan to confirm that she had accepted his offer.Later that day Alan received Cate's acceptance." },
    {
        id: 3, text: "Ellie's Montblanc pen with her name engraved on it was stolen. She puts an advertisement on her personal blog advertising a reward of RM1,000 to anyone who finds it. Frank, who has not seen the advertisement, discovers the pen in a library locker and takes it home. His course mate, Galvin, on seeing the pen, recognizes it as the one for which the reward has been offered, and shows Frank the advertisement in Ellie's blog. Frank returns the pen to Ellie, but she refuses to pay RM 1,000, saying that the offer has been withdrawn. Frank knows that Galvin has been keen to buy his vintage Vespa scooter.On Sunday he tells Galvin that he has decided to sell at RM 5, 000.Galvin says that he is very interested but would like to think about it.Frank says 'I will assume that you want it, unless you tell me otherwise by Friday'.On Thursday, Galvin meets Hassan who tells him that Frank has just agreed to sell the scooter to Jaya for RM6, 000.Galvin immediately texted Frank accepting his offer.Later that day, however, Galvin changes his mind and calls on Frank to tell him to ignore the text message.Frank tells him that his deal with Jaya has fallen through, and he is still keen to sell it to Galvin."
    },{
        id: 4, text: "Andrew used to work for Peter. His job primarily consisted of collecting debts from Peter’s clients. One of Peter’s clients, Trevor, who did not know that Andrew had been dismissed, paid Andrew RM 200 which he owed Peter. Andrew disappeared with the money. Peter wants to know whether he can compel Trevor to pay him again."
    },{
        id: 5, text: "Sam, the Accountant of XYZ Bhd, often acted as the Acting Manager of the company while the Managing Director and other senior staff were absent. His normal duties when in such a position involved overseeing internal company matters and ensuring that his own Accounting Department operated well. While acting as Acting Manager, Sam purchased land at auction from TP on behalf of the company for RM 1 million."
    }, {
        id: 6, text: "Jennifer is a young and very talented squash player. She is sixteen years old and in February 2016, she entered into an agreement in Malaysia with Lawrence (who is a prominent coach) whereby he undertook to train her and also decides which tournament she should play in. In return, Jennifer agreed to follow Lawrence's instructions and to pay him 25% of her winnings from all future tournaments for 2 years. In August 2017, Jennifer disobeyed Lavwrence's instruction to play in European open whereby the total prize money was US 1.2 million and instead prefers to defend her title in the Malaysian open tournament, where the total prize money was only RM350, 000."
    }, {
        id: 7, text: "X has several outstanding debts, including: RM 10,000 owing to B RM 5,000 owing to C Y, X's father, offers to pay B the sum of RM2,500 on the understanding that B will not make any claims against X for the balance of the RM10,000 debt. B agrees but later changes his mind and claims the balance of the debt owed by X. C agrees to accept a sweepstake ticket in the Melbourne Cup in settlement of the debt. Later C thinks that the ticket was not sufficient and wants repayment of half the RM5,000 debt in addition to the ticket."
    }, {
        id: 8, text: "Debbie is going overseas for two months. She asks Michael who is a police officer, and who happened to live in the same neighbourhood to keep an eye on her house while she is away. Debbie promised to pay Michael RM2,000 when she returns. After returning from overseas, Debbie realizes that she doesn't need to pay anything to Michael because Michael is just doing his duty as a police officer. "
    }, {
        id: 9, text: "Annie takes her expensive coat to Simon's Dry Cleaning. She is handed a ticket, the face of which contains a number, her name, a description of the coat and an annotation to the effect that the coat will be available for collection the following Friday. On the reverse side in small print are the words: 'Conditions apply'. On the rear wall facing the counter is a sign written in even smaller print which reads: 'Simon's Dry Cleaning will not be liable for any stains or other damage to any clothing whatsoever’. On Annie's return she discovers the coat has bad stain marks on it."
    }, {
        id: 10, text: "Jim runs a small cartage operation in Kuala Lumpur. One of his best customers is ABC Bhd, which operates a chain of retail stores throughout the metropolitan area. ABC uses Jim to transfer goods from one store to another as the situation requires. The agreed procedure is always the same. ABC telephones Jim and gives him the collection point and the destination. Jim picks up the goods. An employee of ABC and Jim fill in and sign a collection docket. ABC keeps the duplicate. Jim takes the goods directly to the drop off point and has the docket countersigned by another employee of ABC. At 12.30 pm on June 5th Jim collects a quantity of expensive goods from one of ABC's shops. The usual procedure on collection is followed. The docket is filled in, signed and a duplicate kept by ABC. As it is nearly lunch time Jim decides to have lunch before delivering the goods. He travels a number of kilometres off the direct route to another suburb to collect a friend. Together they then go to a hotel which has a great counter lunch. Jim parks on a steep hill. Unfortunately Jim hasn’t checked his brakes lately. They slip and the vehicle races down the hill smashing into a number of obstacles on the way. The goods belonging to ABC are totally destroyed. ABC maintains that Jim must pay for the goods. Jim denies liability on the basis of the exclusion clause. Ticket Terms: This receipt is an acknowledgment that the goods were delivered to Jim in reasonable condition. Consignor must arrange own insurance. Under no circumstances is Jim to be regarded as a common carrier. Jim will use best endeavours to ensure goods delivered safely. Jim does not accept any responsibility for any loss or damage to any goods carried pursuant to this contract however such loss or damage may arise or be caused whether by negligence or otherwise. "
    }, {
        id: 11, text: "On 1 March 2017, the Monash Soccer Team booked a flight to London to participate in the World Universities Football Cup from 21 to 26 March 2017. Their travel agents, Freedom Flight Sdn Bhd, gave a discount fare of RM 2,000 per person, 50% of the price was paid upon booking and the balance of the price was to be paid on 19 March 2017 upon collecting the tickets. On 18 March 2017, the air traffic controllers of KLIA declared a strike when the airport management refused to reduce their retirement age to 45 years old. When the Monash Soccer Team went to Freedom Flight Sdn Bhd on 19 March 2015, he refused to pay the balance unless it is confirmed that the team can fly out of Kuala Lumpur on 19 March 2015. The strike lasted for three days. By that time it was too late for the team to compete in the competition. The Monash Soccer Team claims for the return of the sum paid to Freedom Flight Sdn Bhd. Freedom Flight Sdn Bhd refused to return it and instead sued for the balance 50% to be paid by the Monash Soccer Team."
    }, {
        id: 12, text: "On 30 February 2016, Mr. Ritz signed a contract for the purchase of a house with a housing developer, Ron Realty Sdn Bhd. The contract stipulated the date for the completion and giving of possession of the house on 30 January 2017. Immediately thereafter, the economy in China started to slow down due to international trade restrictions and as a consequence the cost of steel in China doubled. The main supplier of steel to Ron Realty Sdn Bhd was in China and as a result the whole housing project became uneconomical. On December 2016, Ron Realty sent a letter to Mr. Ritz terminating the sale and purchase agreement for reason of frustration caused by the economic crisis in China. Mr. Ritz refused to accept the termination arquing that economic down turn was not a frustrating event."
    }, {
        id: 13, text: "Cathy’s son, Dave, aged 21, was studying for a diploma in computer science at a University in Kuala Lumpur. He lived in a student residence. It was a city council legislative requirement that it was illegal to smoke in student residence, offices, shops, or any enclosed place where someone else is residing, studying or working within the campus. Dave gave up smoking due to this requirement. However, Cathy was worried that under the pressure of preparing for the examination Dave would start smoking again, and so she promised to pay Dave RM500 if he did not smoke at all until he had completed the course. She also promised to buy him a car if he passed the examinations. Cathy run an online bookstore, and asked Dave to maintain and update the website from time to time. She was pleased with the result, and said she would give him RM1,000 ‘for all his hard work’. Dave passed his examinations, obtained his diploma and moved to live in Johor Bahru where there was no legal requirement on banning of smoking in public enclosed areas. He has not started to smoke again after he left Kuala Lumpur. Cathy has not made either of the promised payments, or bought the car."
    }, {
        id: 14, text: "Lilian runs a small tailor shop in Putrajaya specialising in batik wear for women. Her husband Mike owns a factory manufacturing clothes and is able to purchase his fabric much more cheaply than Lilian. On Friday night, after cooking Mike’s favourite meal, Lilian asked Mike if he would supply her shop with fabric at his cost price. Mike said, “Of course darling.” Lilian then decides to expand her business to include batik wear for men and children. On Monday she rings her dye supplier in Kuantan and talks to Neil. She discusses her plans to expand her tailoring business and her need to order additional fabric dye colours suitable for silk, synthetic and cotton fabrics. Neil tells Lilian that all the dye they supply is of the highest quality. Lilian orders 2 dozen of red dye at the price of RM50 each, to be delivered next Friday. She also inquires about gold and silver dyes, and is told by Neil that gold dyes are available for RM150 each, and silver for RM100. Lilian tells Neil that she is prepared to pay RM130 for the gold dye and RM80 for the silver. Lilian also tells Neil that if she doesn’t hear to the contrary, she will take 5 gold and 5 silver boxes of dye, to be delivered with the red dye on Friday. On Friday morning, Lilian receives a delivery from Neil of 24 boxes of red dye. Lilian rings Neil and told him there are no gold or silver dyes. Neil told Lilian he has decided not to supply them at Lilian’s price. Lilian later calls Mike and asks him to send over some fabric she needs at cost price as agreed. Mike replies that he will only provide her with fabric at market price. She protests and reminds him of last Friday evening. He replies, “That was dinner, this is business.” After Lilian hangs up, her assistant Olivia shows her an order for silk scarves on which she has been working using the red dye supplied by Neil. The dye is pale and streaky. She tells Lilian there is a problem with the dye as it is not suitable for silk."
    }, {
        id: 15, text: "Amatjit who intends to buy a cow went to 7akariah's farm house. Alter a walk through and having liked a particular cow, Amarjit asked for assurance whether or not this cow was suffering from any particular illness because he wants to buy for breeding purposes. Zakarlan said ‘the cow iS perfectly healthy; you need not worry about anythung’. Feeling assured, Amarjit immediately bought the cow. Zakariah knew that this cow have been suffering from illness lately and a recent visit by a vet doctor confirmed that the cow was ill and could only survive for another couple of weeks. After the purchase and less than two weeks later, the cow died from illness."
    }, {
        id: 16, text: "In December 2008, Doctor Raju offered to sell his medical practice for RM150,000. Doctor Pritam having gone through the medical practice's income statement accepted the take over. The duration for the entire sale and purchase transaction was determined to be 4 months. During this time, Dr Raju fell ill and was unable to wok most of the time and due to this, his regular patients started going to other doctors. By the time Dr Pritam took over the medical practice, the income derived from it has fallen dramatically, and Dr Raju didn't thought it was necessary to inform Dr Pritam and therefore did not disclose this fact. Dr Pritam who now runs the practice feel's that he has been cheated and wishes to rescind the contract. "
    }, {
        id: 17, text: "Ali owns a padi harvesting tractor. In January he entered into a contract with Bakar in which he agreed to lease the machine to Bakar for two weeks at the beginning of March for RM3,000. Bakar paid Ali a deposit of RM500. In February, Ali realzes that it will be better to sell his tractor due to lack of storage at his premise. Ali than sold it to Chong who is aware of Ali's existing contract with Bakar. In March, Bakar realizes what has happened and calls Chong hoping that Chong will be able to allow him to use the tractor but Chong refuses. Bakar cannot obtain the machine anywhere else at such short notice and taces losing his entire crop if he is unable to harvest it within the next two weeks."
    }, {
        id: 18, text: "Alpha Pty Ltd hires a machine from Beta Machines Ltd. The machine has been negligently maintained by Beta. It breaks down, and it will take Beta three weeks to repair the machine. A replacement can be hired, but none is available for a week. Normal losses amount to RM1,000 a day. [Alpha’s factory operates 7 days a week.] Alpha Pty Ltd has also lost a lucrative government contract worth a further RM50,000. The hire of the replacement machine is RM5,000 in total. What damages can Alpha Pty Ltd claim? a) $21,000 b) $71,000 c) $5,000 d) $12,000 e) $62,000."
    }, {
        id: 19, text: "You are the legal compliance team who work for The Southern Cross Hospital which is in conflict with Zapit Ltd and wants your help resolving the following problem. The hospital hired an X-ray machine from Zapit Ltd. At the time of hiring, the hospital manager enquired about maintenance of the X-ray and was told that all maintenance was the responsibility of the hospital during the period of hire. At the same time the hospital manager was presented with a three page pre-typed document for signature. The manager only read parts of the document. One clause that the manager did not read said: “Any maintenance must be carried out by Zapit Ltd. Strict compliance with this condition is of the essence of the contract.” The hospital repaired the X-ray using its own hospital maintenance staff. The staff are highly skilled and able to carry out such repairs. When Zapit heard of the hospital’s actions it notified the hospital that the contract was terminated and the machine had to be returned immediately. The hospital is unable to replace the machine at short notice and wants to know if it has to return the X-ray."
    }, {
        id: 20, text: "Bachhi Bhd (BB) purchased three earthmovers from Whitewash Sdn Bhd (WB) and used them on its worksite. After two and a half months, the former requested the latter to take back the said equipment on the basis that the said equipment were not suitable for the purpose for which they were bought. BB did this on the basis of a purported oral promise made by WSB when the sale was made. The alleged oral promise was to the effect that if the earthmovers were inappropriate, BB could return them without incurring any financial liability. WSB complied with BB's request and removed the earthmovers but remain adamant to the fact that BB should pay compensation for breach of contract."
    }

];

// Store the courtCasePageNumber button Ids.
var courtCasePageNumberIds = [];

// Store related section buttons Ids.
var relatedSectionBtnIds = [];

var currentCourtCaseCount = 1;

// function that runs all necessary initial retrieval.
function init() {
    // Get the first id scenerio from db.
    getScenarioList();
    createRelationButtons();
    displayUser();
    getLegalConcepts();
    createReasonButtons();
}

// The the list of scenarios available in the database.
function getScenarioList() {
    // get all declared scenarios.
    var scenarioSelect = document.getElementById("scenarioSelect");

    $.each(scenarioList, function (index, value) {
        scenarioSelect.innerHTML +=
            ('<option value="' + value.id + '">' + value.id + '</option>\n');
    });
}

// get scenario based on id.
function getScenario() {
    const scenarioSelect = document.getElementById('scenarioSelect');

    let selectedId = scenarioSelect.value;

    if (selectedId == 0) {
        var element = document.getElementById("ScenarioText");
        element.innerHTML = null;
        return;
    }

    $.each(scenarioList, function (index, value) {
        if (value.id == selectedId) {
            changeScenarioText(value);
        }
    });

    // Clear all annotations.
    r.clearAnnotations();

    // Clear all annotation buttons and reset the annotation button array.
    removeAllAnnotationBtnIds();
    annotationBtnIds = [];
}

// Change the scenario text based on retrieved scenario text from db.
function changeScenarioText(scenario) {
    var scenarioText = document.getElementById("ScenarioText");
    scenarioText.innerHTML = scenario.text;
}

function createRelationButtons() {
    // Const relation.
    const relationData = [
        { name: ' { IF  ELSE  }', text: '{ IF......ELSE......  } ' },
        { name: ' { IF  THEN }', text: '{ IF ..... THEN .... } ' },
        { name: ' { ONLY IF }', text: '{ ONLY IF......} ' },
        { name: ' { AND }', text: '{AND}' },
        { name: ' { OR }', text: '{OR}' },
        { name: ' { HOWEVER }', text: '{HOWEVER}' },
    ];

    // Get relation btn div id.
    var relationBtnDiv = document.getElementById('relationBtns');

    $.each(relationData, function (index, value) {
        // Create button element.
        var button = document.createElement('button');

        button.type = 'button';
        button.className = 'btn btn-outline-info';

        // Id will be the relationName + 'Btn'.
        // Ex.Selected IfElse => The button id is 'IfElseBtn'.
        // It is case senstive and also will take in spaces.
        button.id = value.name + 'Btn';

        // Add text to be displayed on button.
        button.innerHTML = value.name;

        // Add onClick event to add the selected relation to analysis text area at the cursor.
        button.addEventListener('click', function (event) {
            // Get current position of cursor at analysis text area.
            // If no cursor, it will append at the end of the textArea's text.
            var analysisTxtBox = document.getElementById('analysisTextArea');
            let curPos = analysisTxtBox.selectionStart;

            // Get current text in analysisTextArea.
            var analysisTextAreaValue = $('#analysisTextArea').val();

            // Insert text at cursor position.
            $('#analysisTextArea').val(
                analysisTextAreaValue.slice(0, curPos) + value.text + analysisTextAreaValue.slice(curPos));

            // Restore cursor position to end of analysis text area after clicking on button.
            analysisTextArea.focus();
        });

        // Append the  button to annotation div.
        relationBtnDiv.appendChild(button);
    });
}

function createReasonButtons() {
    // Const relation.
    const relationData = [
        { name: ' { LEGALLIZATION}', text: '{LEGALLIZATION}' },
        { name: ' { COMMON_SENSE }', text: '{COMMON_SENSE}' },
        { name: ' { CO-REFERENCE }', text: '{CO-REFERENCE}' },
    ];

    // Get relation btn div id.
    var relationBtnDiv = document.getElementById('reasonBtns');

    $.each(relationData, function (index, value) {
        // Create button element.
        var button = document.createElement('button');

        button.type = 'button';
        button.className = 'btn btn-outline-primary';

        // Id will be the relationName + 'Btn'.
        // Ex.Selected IfElse => The button id is 'IfElseBtn'.
        // It is case senstive and also will take in spaces.
        button.id = value.name + 'Btn';

        // Add text to be displayed on button.
        button.innerHTML = value.name;

        // Add onClick event to add the selected relation to analysis text area at the cursor.
        button.addEventListener('click', function (event) {
            // Get current position of cursor at analysis text area.
            // If no cursor, it will append at the end of the textArea's text.
            var analysisTxtBox = document.getElementById('analysisTextArea');
            let curPos = analysisTxtBox.selectionStart;

            // Get current text in analysisTextArea.
            var analysisTextAreaValue = $('#analysisTextArea').val();

            // Insert text at cursor position.
            $('#analysisTextArea').val(
                analysisTextAreaValue.slice(0, curPos) + value.text + analysisTextAreaValue.slice(curPos));

            // Restore cursor position to end of analysis text area after clicking on button.
            analysisTextArea.focus();
        });

        // Append the  button to annotation div.
        relationBtnDiv.appendChild(button);
    });
}

function saveFile() {
    // Get the data from each element on the form.
    var selectText_Tags = highlitedObject;
    var Username = document.getElementById('userDisplay');
    var scenarioID = document.getElementById('scenarioSelect');
    var issues = document.getElementById('issues');
    var analysis = document.getElementById('analysisTextArea');
    var conclusion = document.getElementById('conclusion');
    var selectedSectionOptions = $('#selectedSections').val();

    let relatedCourtCasePageNumbers = [];
    // Get list of filled court case and pg number.
    for (let i = 1; i <= currentCourtCaseCount; i++) {
        let relatedCourtCaseId = 'relatedCourtCase_' + i;
        let courtCaseNumId = 'courtCase_Num_' + i;
        let relatedCourtCase = document.getElementById(relatedCourtCaseId);
        let courtCaseNum = document.getElementById(courtCaseNumId);

        relatedCourtCasePageNumbers.push(relatedCourtCase.value + '[' + courtCaseNum.value + ']');
    }

    // This variable stores all the data.

    var data_json = {
        "User": Username.innerHTML,
        "ScenarioID": scenarioID.value,
        "Text_Tags": selectedAnnotation,
        "Selected_Relations": selectedRelations,
        "Issues": issues.value,
        "Sections": selectedSectionOptions,
        "RelatedCourtCase_pageNumList": relatedCourtCasePageNumbers,
        "Analysis": analysis.value,
        "Conclusion": conclusion.value,
        "Original_Objects": highlitedObject
    };

    var data = JSON.stringify(data_json);

    console.log(data_json);
    var currentdate = new Date();
    var date = currentdate.getDate() + "_" + (currentdate.getMonth() + 1) + "_" +
        currentdate.getHours() + currentdate.getMinutes();
    var filename = 'Annotated_' + scenarioID.value + '_' + date + '.txt'

    let blob = new Blob([data]);
    let url = URL.createObjectURL(blob);
    let file = document.createElement(`a`);
    file.download = filename;
    file.href = url;
    document.body.appendChild(file);
    file.click();
    file.remove();
    URL.revokeObjectURL(url);
}

function displayUser() {
    var inputTest = localStorage['username'];
    /*alert('Inserted Data ' + localStorage['username']);*/
    console.log('User name : ', inputTest)
    document.getElementById('userDisplay').innerHTML = inputTest;
}

// Function to remove all the annotation btn ids from the list.
function removeAllAnnotationBtnIds() {
    $.each(annotationBtnIds, function (index, value) {
        var elem = document.getElementById(value);
        elem.parentNode.removeChild(elem);
    });
}

// Function to generate related sections button.
// Will replace the existing buttons if any.
// Cannot create if there are no selected related sections(disabled by UI).
function generateRelatedSectionsBtn() {
    // remove existing court case page number button id if not null.
    if (relatedSectionBtnIds.length > 0) {
        $.each(relatedSectionBtnIds, function (index, value) {
            var elem = document.getElementById(value);
            elem.parentNode.removeChild(elem);
        });
        relatedSectionBtnIds = [];
    }

    // Get courtCasePageNumberBtns div id.
    var relatedSectionBtnsDiv = document.getElementById('relatedSectionBtns');

    let relationSectionArray = $('#selectedSections').val();

    $.each(relationSectionArray, function (index, value) {
        // Create button element.
        var button = document.createElement('button');

        button.type = 'button';
        button.className = 'btn btn-outline-secondary';

        let mergedText = '{' + 'Section ' + value + '}';

        // Id will be the relationName + 'Btn'.
        // Ex.Selected IfElse => The button id is 'IfElseBtn'.
        // It is case senstive and also will take in spaces.
        button.id = mergedText + 'Btn';

        // Store related section btn id.
        relatedSectionBtnIds.push(button.id);

        // Add text to be displayed on button.
        button.innerHTML = mergedText;

        // Add onClick event to add the selected relation to analysis text area at the cursor.
        button.addEventListener('click', function (event) {
            // Get current position of cursor at analysis text area.
            // If no cursor, it will append at the end of the textArea's text.
            var analysisTxtBox = document.getElementById('analysisTextArea');
            let curPos = analysisTxtBox.selectionStart;

            // Get current text in analysisTextArea.
            var analysisTextAreaValue = $('#analysisTextArea').val();

            // Insert text at cursor position.
            $('#analysisTextArea').val(
                analysisTextAreaValue.slice(0, curPos) + mergedText + analysisTextAreaValue.slice(curPos));

            // Restore cursor position to end of analysis text area after clicking on button.
            analysisTextArea.focus();
        });

        // Append the  button to annotation div.
        relatedSectionBtnsDiv.appendChild(button);
    });
}

// Function to check if the the generate related section(RS) button is disabled.
function checkDisabledRS() {
    let selectedSectionOptions = $('#selectedSections').val().toString();
    console.log(selectedSectionOptions);
    if (selectedSectionOptions == '') {
        document.getElementById('generateRSBtn').disabled = true;
    }
    else {
        document.getElementById('generateRSBtn').disabled = false;
    }
}

// function to get scenario based on id.
function getLegalConcepts() {
    // remove all table rows except the first(header).
    $("#legalConceptTable").find("tr:not(:first)").remove();

    // get declared legalConcepts.
    // remember to update the same one in scenario.html script.
    const legalConcepts2 = [
        { id: 1, name: 'Offer Date', relatedTopic: 'Offer and Acceptance', relatedSection: 'Section3', other: '' },
        { id: 2, name: 'Communication of Acceptance', relatedTopic: 'Offer and Acceptance', relatedSection: 'Section3', other: '' }
    ];

    displayLegalConcepts(legalConcepts2);
}

// assign legal concept rows of data to legal concepts table html.
function displayLegalConcepts(legalConcepts) {
    var table = document.getElementById("legalConceptTable");

    $.each(legalConcepts, function (index, value) {
        table.innerHTML +=
            ('<tr>\n' +
                '<td>' + value.id + '</td>\n' +
                '<td>' + value.name + '</td>\n' +
                '<td>' + value.relatedTopic + '</td>\n' +
                '<td>' + value.relatedSection + '</td>\n' +
                '<td>' + value.other + '</td>\n' +
                '</tr>');
    });
}

function addCourtCase() {
    // get view element.
    let courtCaseView = document.getElementById("courtCaseView");

    // Increase court case global count.
    currentCourtCaseCount++;

    let newCourtCaseInput = document.createElement('span');
    newCourtCaseInput.innerHTML =
        ('<div class="row" id="courtCase_' + currentCourtCaseCount + '" style="margin-bottom: 10px;">'
            + '<div class="col-sm-2">'
            + '<label class="col-form-label">#' + currentCourtCaseCount + '</label>'
            + '</div>'
            + '<div class="col-sm-4">'
            + '<input type="text" class="form-control" id="relatedCourtCase_' + currentCourtCaseCount + '">'
            + '</div>'
            + '<div class="col-sm-4">'
            + '<input type="text" class="form-control" id="courtCase_Num_' + currentCourtCaseCount + '">'
            + '</div>'
            + '<div class="col-sm-2">'
            + '</div>'
            + '</div>');
    courtCaseView.appendChild(newCourtCaseInput);
}

function removeCourtCase() {
    // Do not allow remove if currentCourtCaseCount is 1.
    // There must always be one court case available.
    if (currentCourtCaseCount != 1) {
        // Get court case id to remove based on global current court case count.
        let courtCaseId = 'courtCase_' + currentCourtCaseCount;

        // Remove target court case.
        var elem = document.getElementById(courtCaseId);
        elem.parentNode.removeChild(elem);

        // Reduce gloval court case count.
        currentCourtCaseCount--;
    }
}

// Function to generate court case page number button.
// Will replace the existing button if any.
// Cannot create a court case page number button if the two affected fields are null or String empty('').
function generateCourtCasePageNumberBtn() {
    // remove existing court case page number button ids if not null.
    if (courtCasePageNumberIds.length > 0) {
        $.each(courtCasePageNumberIds, function (index, value) {
            var elem = document.getElementById(value);
            elem.parentNode.removeChild(elem);
        });
        courtCasePageNumberIds = [];
    }

    // Loop for the number of currentCourtCaseCount.
    for (let i = 1; i <= currentCourtCaseCount; i++) {
        let relatedCourtCase = 'relatedCourtCase_' + i;
        let courtCaseNum = 'courtCase_Num_' + i;
        // If either field is null, do not create button.
        let relatedCourtCaseField = document.getElementById(relatedCourtCase);
        if (relatedCourtCaseField.value == null || relatedCourtCaseField.value == '')
            return;

        let relatedCourtCaseNumField = document.getElementById(courtCaseNum);
        if (relatedCourtCaseNumField.value == null || relatedCourtCaseField.value == '')
            return;

        // Merge the court case and page number text into one text.
        let mergedCourtCasePageNumberText = '{' + relatedCourtCaseField.value + '[' + relatedCourtCaseNumField.value + ']' + '}';

        // Get courtCasePageNumberBtns div id.
        let courtCasePageNumberBtnsDiv = document.getElementById('courtCasePageNumberBtns');

        // Create button element.
        let button = document.createElement('button');

        button.type = 'button';
        button.className = 'btn btn-outline-primary';

        // Id will be the relationName + 'Btn'.
        // Ex.Selected IfElse => The button id is 'IfElseBtn'.
        // It is case senstive and also will take in spaces.
        button.id = mergedCourtCasePageNumberText + 'Btn';

        // Add button id to global.
        courtCasePageNumberIds.push(button.id);

        // Add text to be displayed on button.
        button.innerHTML = mergedCourtCasePageNumberText;

        // Add onClick event to add the selected relation to analysis text area at the cursor.
        button.addEventListener('click', function (event) {
            // Get current position of cursor at analysis text area.
            // If no cursor, it will append at the end of the textArea's text.
            let analysisTxtBox = document.getElementById('analysisTextArea');
            let curPos = analysisTxtBox.selectionStart;

            // Get current text in analysisTextArea.
            let analysisTextAreaValue = $('#analysisTextArea').val();

            // Insert text at cursor position.
            $('#analysisTextArea').val(
                analysisTextAreaValue.slice(0, curPos) + mergedCourtCasePageNumberText + analysisTextAreaValue.slice(curPos));

            // Restore cursor position to end of analysis text area after clicking on button.
            analysisTextArea.focus();
        });

        // Append the  button to annotation div.
        courtCasePageNumberBtnsDiv.appendChild(button);
    }
}


function getLegalConcepts() {
    // remove all table rows except the first(header).
    $("#legalConceptTable").find("tr:not(:first)").remove();

    // get declared legalConcepts.
    // remember to update the same one in scenario.html script.
    const legalConcepts = [
        { id: 1, name: 'invitation to treat', relatedTopic: 'Offer and Acceptance', relatedSection: 'Section3', other: '' },
        { id: 2, name: 'Display of goods for sale', relatedTopic: 'Offer and Acceptance', relatedSection: 'Section3', other: '' },
        { id: 3, name: 'Tender documents', relatedTopic: 'Offer and Acceptance', relatedSection: 'Section3', other: '' },
        { id: 4, name: 'Price Quotation', relatedTopic: 'Offer and Acceptance', relatedSection: 'Section3', other: '' },
        { id: 5, name: 'Auction', relatedTopic: 'Offer and Acceptance', relatedSection: 'Section3', other: '' },
        { id: 6, name: 'Advertisements', relatedTopic: 'Offer and Acceptance', relatedSection: 'Section3', other: '' },
        { id: 7, name: 'Offeror', relatedTopic: 'Offer and Acceptance', relatedSection: 'Section3', other: '' },
        { id: 8, name: 'legal capacity', relatedTopic: 'Offer and Acceptance', relatedSection: 'Section3', other: '' },
        { id: 9, name: 'offeree', relatedTopic: 'Offer and Acceptance', relatedSection: 'Section3', other: '' },
        { id: 10, name: 'offer', relatedTopic: 'Offer and Acceptance', relatedSection: 'Section3', other: '' },
        {
            id: 11, name: 'promise', relatedTopic: 'Offer and Acceptance', relatedSection: 'Section3', other: ''
        },
        { id: 12, name: 'product for money', relatedTopic: 'Offer and Acceptance', relatedSection: 'Section3', other: '' },
        { id: 13, name: 'termination of offer', relatedTopic: 'Offer and Acceptance', relatedSection: 'Section3', other: '' },
        { id: 14, name: 'Rejection', relatedTopic: 'Offer and Acceptance', relatedSection: 'Section3', other: '' },
        { id: 15, name: 'Lapse of time', relatedTopic: 'Offer and Acceptance', relatedSection: 'Section3', other: '' },
        { id: 16, name: 'Contingent condition subsequent ', relatedTopic: 'Offer and Acceptance', relatedSection: 'Section3', other: '' },
        { id: 17, name: 'Death', relatedTopic: 'Offer and Acceptance', relatedSection: 'Section3', other: '' },
        { id: 18, name: 'Revocation', relatedTopic: 'Offer and Acceptance', relatedSection: 'Section3', other: '' },
        { id: 19, name: 'Counter- Offer', relatedTopic: 'Offer and Acceptance', relatedSection: 'Section3', other: '' },
        { id: 20, name: 'acceptance', relatedTopic: 'Offer and Acceptance', relatedSection: 'Section3', other: '' },
        { id: 21, name: 'Cross-offer', relatedTopic: 'Offer and Acceptance', relatedSection: 'Section3', other: '' },
        { id: 22, name: 'Mere injuiry ', relatedTopic: 'Offer and Acceptance', relatedSection: 'Section3', other: '' },
        { id: 23, name: 'Mode of Acceptance ', relatedTopic: 'Offer and Acceptance', relatedSection: 'Section3', other: '' },
        { id: 24, name: 'General Rule', relatedTopic: 'Offer and Acceptance', relatedSection: 'Section3', other: '' },
        { id: 25, name: 'By instantaneous communication', relatedTopic: 'Offer and Acceptance', relatedSection: 'Section3', other: '' },
        { id: 26, name: 'By conduct', relatedTopic: 'Offer and Acceptance', relatedSection: 'Section3', other: '' },
        {
            id: 27, name: 'Postal Rule', relatedTopic: 'Offer and Acceptance', relatedSection: 'Section3', other: ''
        },
        { id: 28, name: 'intension to create legal relations', relatedTopic: 'Offer and Acceptance', relatedSection: 'Section3', other: '' },
        { id: 29, name: 'Social and Domestic context', relatedTopic: 'Offer and Acceptance', relatedSection: 'Section3', other: '' },

    ];

    displayLegalConcepts(legalConcepts);
}

// assign legal concept rows of data to legal concepts table html.
function displayLegalConcepts(legalConcepts) {
    var table = document.getElementById("legalConceptTable");

    $.each(legalConcepts, function (index, value) {
        table.innerHTML +=
            ('<tr>\n' +
                '<td>' + value.id + '</td>\n' +
                '<td>' + value.name + '</td>\n' +
                '<td>' + value.relatedTopic + '</td>\n' +
                '<td>' + value.relatedSection + '</td>\n' +
                '<td>' + value.other + '</td>\n' +
                '</tr>');
    });
}