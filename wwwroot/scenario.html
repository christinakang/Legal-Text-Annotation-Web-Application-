<!doctype html>

<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Bootstrap core JavaScript-->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script type="text/javascript" src="vendor/bootstrap/js/bootstrap.min.js"></script>

    <!-- Include bootstrap multiselect js and css -->
    <script type="text/javascript" src="js/bootstrap-multiselect.js"></script>
    <link rel="stylesheet" href="css/bootstrap-multiselect.css" type="text/css" />

    <!-- Core plugin JavaScript-->
    <script src="vendor/jquery-easing/jquery.easing.min.js"></script>

    <!-- Custom scripts for all pages-->
    <script src="js/sb-admin-2.min.js"></script>

    <!-- Custom fonts for this template-->
    <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
          rel="stylesheet">

    <!-- Custom styles for this template-->
    <link href="css/sb-admin-2.min.css" rel="stylesheet">
    <link href="css/recogito.min.css" rel="stylesheet">

    <!-- Functions-->
    <script type="text/javascript" src="js/scenario.js"></script>
    <script type="text/javascript" src="js/recogito.min.js"></script>

    <title>Scenario</title>
</head>

<body id="page-top" onload=init(),displayUser()>

    <!-- Page Wrapper -->
    <div id="wrapper">

        <!-- Sidebar -->
        <ul class="navbar-nav bg-gradient-primary sidebar sidebar-dark accordion" id="accordionSidebar">

            <!-- Sidebar - Brand -->
            <a class="sidebar-brand d-flex align-items-center justify-content-center" href="index.html">
                <div class="sidebar-brand-icon rotate-n-15">
                    <i class="fas fa-laugh-wink"></i>
                </div>
                <div class="sidebar-brand-text mx-3">Legal Text Annotation</div>
            </a>

            <!-- Nav Item - Dashboard -->
            <li class="nav-item">
                <a class="nav-link" href="index.html">
                    <i class="fas fa-fw fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </a>
            </li>

            <!-- Nav Item - Charts -->
            <li class="nav-item">
                <a class="nav-link" href="scenario.html">
                    <i class="fas fa-fw fa-chart-area"></i>
                    <span>scenarios </span>
                </a>
            </li>

            <!-- Nav Item - Tables -->
            <li class="nav-item">
                <a class="nav-link" href="LegalConcept.html">
                    <i class="fas fa-fw fa-table"></i>
                    <span>Legal Concepts</span>
                </a>
            </li>

            <!-- Nav Item - Tables -->
            <li class="nav-item">
                <a class="nav-link" href="review.html">
                    <i class="fas fa-fw fa-table"></i>
                    <span>Review</span>
                </a>
            </li>

            <!-- Divider -->
            <hr class="sidebar-divider d-none d-md-block">

            <!-- Sidebar Toggler (Sidebar) -->
            <div class="text-center d-none d-md-inline">
                <button class="rounded-circle border-0" id="sidebarToggle"></button>
            </div>
        </ul>
        <!-- End of Sidebar -->
        <!-- Content Wrapper -->
        <div id="content-wrapper" class="d-flex flex-column">

            <!-- Main Content -->
            <div id="content">

                <!-- Topbar -->
                <nav class="navbar navbar-expand navbar-light bg-white topbar mb-4 static-top shadow">

                    <!-- Sidebar Toggle (Topbar) -->
                    <button id="sidebarToggleTop" class="btn btn-link d-md-none rounded-circle mr-3">
                        <i class="fa fa-bars"></i>
                    </button>

                    <!-- Topbar Navbar -->
                    <ul class="navbar-nav ml-auto">

                        <div class="topbar-divider d-none d-sm-block"></div>

                        <!-- Nav Item - User Information -->
                        <li class="nav-item dropdown no-arrow">
                            <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button"
                               data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <label id="userDisplay" class="mr-2 d-none d-lg-inline text-gray-600 small"></label>
                                <img class="img-profile rounded-circle"
                                     src="img/undraw_profile.svg">
                            </a>
                            <!-- Dropdown - User Information -->
                            <div class="dropdown-menu dropdown-menu-right shadow animated--grow-in"
                                 aria-labelledby="userDropdown">
                                <a class="dropdown-item" href="#" data-toggle="modal" data-target="#logoutModal">
                                    <i class="fas fa-sign-out-alt fa-sm fa-fw mr-2 text-gray-400"></i>
                                    Logout
                                </a>
                            </div>
                        </li>
                    </ul>
                </nav>
                <!-- End of Topbar -->
                <!-- Begin Page Content -->
                <div class="container-fluid">

                    <!-- Page Heading -->
                    <h1 class="h3 mb-4 text-gray-800">Annotation </h1>
                    <!-- Basic Card Example -->
                    <div class="card shadow mb-4">
                        <div class="card-header py-3">
                            <h6 class="m-0 font-weight-bold text-primary">Scenario Select </h6>
                        </div>

                        <div class="card-header py-3">
                            <select id="scenarioSelect" onchange="getScenario()" class="form-select" aria-label="Default select example">
                                <option value="0" selected>Select scenario</option>
                            </select>
                        </div>
                    </div>
                    <div class="card shadow mb-4">
                        <div class="card-header py-3">
                            <div>
                                <button id="toggle-mode" class="btn btn-primary">CHANGE MODE: ANNOTATION</button>
                            </div>
                            <h6 class="m-0 font-weight-bold text-primary">Scenario Text </h6>
                        </div>

                        <div class="card-body">
                            <div id="ScenarioContent" class="plaintext" style="margin-top: 1em; margin-bottom: 1em;">
                                <br />
                                <p id="ScenarioText"></p>
                                <br />
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">IRAC Analysis</h5>
                        <!-- General Form Elements -->
                        <form>
                            <div class="row">
                                <label for="inputText" class="col-sm-2 col-form-label">Issues</label>
                                <div class="col-sm-10">
                                    <input type="text" class="form-control">
                                </div>
                            </div>
                            <br />

                            <div class="row">
                                <label class="col-sm-2 col-form-label">Select Related sections </label>
                                <select class="col-sm-10" id="sectionMultiSelect" multiple="multiple">
                                    <option value="1">Section 1</option>
                                    <option value="2">Section 2</option>
                                    <option value="3">Section 3</option>
                                    <option value="4">Section 4</option>
                                    <option value="5">Section 5</option>
                                    <option value="6">Section 6</option>
                                </select>
                            </div>
                            <br />

                            <div class="row mb-3">
                                <div class="col-sm-6">
                                    <label for="inputText2" class="col-sm-6 col-form-label">Related court case</label>
                                    <div class="col-sm-6">
                                        <input type="text" class="form-control">
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <label for="inputText2" class="col-sm-6 col-form-label">Paragraph Number or Page number of the court case</label>
                                    <div class="col-sm-6">
                                        <input type="text" class="form-control">
                                    </div>
                                </div>
                            </div>
                            <br />

                            <div class="row">
                                <label class="col-sm-12 col-form-label">Annotation Buttons</label>
                                <div class="col-sm-12 alert alert-primary" role="alert">
                                    Annotation buttons will appear after highlighting the texts in the scenario above.<br />
                                    Clicking on these buttons will add the annotation button text at start of the cursor in the analysis text box.<br />
                                    If there is no cursor it will append to the end of the text. <br />
                                </div>
                                <div class="col-sm-12 m-1" id="annotationBtns">
                                </div>
                            </div>
                            <br />

                            <div class="row">
                                <label class="col-sm-12 col-form-label">Relation Buttons</label>
                                <div class="col-sm-12 alert alert-primary" role="alert">
                                    Clicking on these buttons will add the relationship text at start of the cursor in the analysis text box.<br />
                                    If there is no cursor it will append to the end of the text.<br />
                                </div>
                                <div class="col-sm-12" id="relationBtns">
                                </div>
                            </div>
                            <br />

                            <div class="form-floating">
                                <label for="analysisTextArea">Analysis</label>
                                <textarea class="form-control" placeholder="Analysis here" id="analysisTextArea" style="height: 100px;"></textarea>
                            </div>
                            <br />

                            <div class="row">
                                <label for="inputText3" class="col-sm-2 col-form-label">Conclusion</label>
                                <div class="col-sm-10">
                                    <input type="text" class="form-control">
                                </div>
                            </div>
                            <br />

                            <div class="row">
                                <label class="col-sm-2 col-form-label">Submit Button</label>
                                <div class="col-sm-10">
                                    <button type="submit" class="btn btn-primary">Submit</button>
                                </div>
                            </div>
                            <br />
                        </form>
                    </div>
                    <!-- /.container-fluid -->
                    <div class="col-sm-12">
                        <button class="btn btn-success btn-icon-split">ADD IRAC</button>
                    </div>
                </div>
                <!-- End of Main Content -->
            </div>
            <!-- End of Content Wrapper -->
        </div>
    </div>
    <!-- End of Page Wrapper -->
    <!-- Scroll to Top Button-->
    <a class="scroll-to-top rounded" href="#page-top">
        <i class="fas fa-angle-up"></i>
    </a>
</body>
</html>

<!--Script to handle annotation of scenarios and auto button creation for highlighted text.-->
<script type="text/javascript">

    // Get legal concepts.

    const legalConceptList = [];

    fetch(legalConceptUri)
        .then(response => response.json())
        .then(data => {
            // Store legal concepts in legalConceptList.

            $.each(data, function (index, value) {
                legalConceptList.push(value.name);
            });
        })
        .catch(error => console.error('Unable to get legal concepts', error));

    // Intialize Recogito.

    var r = Recogito.init({
        content: 'ScenarioContent', // Element id or DOM node to attach to.
        locale: 'auto',
        allowEmpty: true,
        widgets: [
            /*            { widget: 'COMMENT' },*/ // Disabled comment since not used?
            { widget: 'TAG', vocabulary: legalConceptList /*Set selectable vocabulary as legalConceptList.*/ }
        ],
        relationVocabulary: ['isRelated', 'isPartOf', 'isSameAs ']
    });

    // Switch annotation mode (annotation/relationships).

    var annotationMode = 'ANNOTATION'; // or 'RELATIONS'.

    var toggleModeBtn = document.getElementById('toggle-mode');
    toggleModeBtn.addEventListener('click', function () {
        if (annotationMode === 'ANNOTATION') {
            toggleModeBtn.innerHTML = 'MODE: RELATIONS';
            annotationMode = 'RELATIONS';
        } else {
            toggleModeBtn.innerHTML = 'MODE: ANNOTATION';
            annotationMode = 'ANNOTATION';
        }

        r.setMode(annotationMode);
    });

    // Function that detectes a newly created annotation.

    r.on('createAnnotation', function (annotation) {
        // Log highlighted text as new annotation for debugging purposes.
        console.log('created', annotation);
        console.log('test retrieved value: ', annotation.target.selector[0].exact);

        // On created annotation add a button with selected text for IRAC Analysis processing.
        var selectedAnnotationText = annotation.target.selector[0].exact;

        var annotationBtnDiv = document.getElementById('annotationBtns');

        // Create button element.
        var button = document.createElement('button');

        button.type = 'button';

        // Id will be the selectedAnnotationText + 'Btn'.
        // Ex.Selected legal => The button id is 'legalBtn'.
        // It is case senstive and also will take in spaces.
        button.id = selectedAnnotationText + 'Btn';

        // Add text to be displayed on button.
        button.innerHTML = selectedAnnotationText;

        // Add onClick event to add the selected annotation to analysis text area at the cursor.
        button.addEventListener('click', function (event) {
            console.log(button.innerHTML);

            // Get current position of cursor at analysis text area.
            // If no cursor, it will append at the end of the textArea's text.
            var analysisTxtBox = document.getElementById('analysisTextArea');
            let curPos = analysisTxtBox.selectionStart;

            // Get current text in analysisTextArea.
            var analysisTextAreaValue = $('#analysisTextArea').val();

            // Insert text at cursor position.
            $('#analysisTextArea').val(
                analysisTextAreaValue.slice(0, curPos) + selectedAnnotationText + analysisTextAreaValue.slice(curPos));

            // Restore cursor position to end of analysis text area after clicking on button.
            analysisTextArea.focus();
        });

        // Append the  button to annotation div.
        annotationBtnDiv.appendChild(button);
    });
</script>

<!--Script to display user name.-->
<script>
    function displayUser() {
        var inputTest = localStorage['username'];
        /*alert('Inserted Data ' + localStorage['username']);*/
        document.getElementById('userDisplay').innerHTML = inputTest;
    }
</script>

<!--Script to initialize multiselect for sections.-->
<script type="text/javascript">
    /*Note refer here for API documentation : https://davidstutz.github.io/bootstrap-multiselect/index.html#further-examples*/
    $(document).ready(function () {
        $('#sectionMultiSelect').multiselect();
    });
</script>